<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>在线视频技术 - 视频处理学习</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'base',
            themeVariables: {
                primaryColor: '#667eea',
                primaryTextColor: '#fff',
                primaryBorderColor: '#764ba2',
                lineColor: '#667eea',
                secondaryColor: '#764ba2',
                tertiaryColor: '#f0f0f0'
            }
        });
    </script>
</head>
<body>
    <div class="layout-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1><a href="index.html" style="color: white; text-decoration: none;">VideoLearn</a></h1>
            </div>
            <nav class="sidebar-nav">
                <ul class="nav-tree">
                    <li>
                        <span class="nav-category">其他章节</span>
                        <ul class="sub-nav">
                            <li><a href="basics.html">基础知识</a></li>
                            <li><a href="codec.html">编解码技术</a></li>
                            <li><a href="ai.html">AI视频处理</a></li>
                            <li><a href="tools.html">工具框架</a></li>
                            <li><a href="code.html">代码示例</a></li>
                        </ul>
                    </li>
                    <li>
                        <span class="nav-category">在线视频技术</span>
                        <ul class="sub-nav">
                            <li><a href="#streaming-arch" class="active">流媒体架构</a></li>
                            <li><a href="#protocols">流媒体协议</a></li>
                            <li><a href="#live">直播技术</a></li>
                            <li><a href="#vod">点播技术</a></li>
                            <li><a href="#cdn">CDN分发</a></li>
                            <li><a href="#abr">自适应码率</a></li>
                        </ul>
                    </li>
                </ul>
            </nav>
        </aside>

        <main class="main-content">
            <section id="streaming" class="section">
                <div class="container">
                    <h2>📡 在线视频技术可视化</h2>
                    <p style="color: #718096; margin-bottom: 30px;">直播、点播、流媒体协议架构全景</p>

                    <!-- 流媒体架构 -->
                    <div class="topic-item" id="streaming-arch">
                        <h3>流媒体系统架构</h3>
                        
                        <div class="diagram-container">
                            <div class="diagram-title">在线视频系统完整架构</div>
                            <pre class="mermaid">
graph TB
    subgraph Source["内容源"]
        A1[摄像头采集]
        A2[文件上传]
        A3[屏幕录制]
    end
    
    subgraph Ingest["内容采集"]
        B1[推流端<br/>推流SDK]
        B2[转码服务]
    end
    
    subgraph Processing["内容处理"]
        C1[实时转码]
        C2[多码率编码]
        C3[封装封装]
        C4[内容加密]
    end
    
    subgraph Distribution["内容分发"]
        D1[CDN边缘节点]
        D2[负载均衡]
        D3[缓存服务]
    end
    
    subgraph Playback["播放端"]
        E1[Web播放器]
        E2[移动App]
        E3[智能电视]
    end
    
    Source --> Ingest
    Ingest --> Processing
    Processing --> Distribution
    Distribution --> Playback
    
    style Source fill:#e3f2fd
    style Processing fill:#f3e5f5
    style Distribution fill:#fff9c4
    style Playback fill:#c8e6c9
                            </pre>
                        </div>

                        <table class="visual-table">
                            <thead>
                                <tr>
                                    <th>系统组件</th>
                                    <th>核心功能</th>
                                    <th>关键技术</th>
                                    <th>性能指标</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>采集推流</strong></td>
                                    <td>音视频采集编码</td>
                                    <td>RTMP/WebRTC推流</td>
                                    <td>延迟 < 1秒</td>
                                </tr>
                                <tr>
                                    <td><strong>转码处理</strong></td>
                                    <td>多码率转码</td>
                                    <td>FFmpeg/GPU加速</td>
                                    <td>实时处理</td>
                                </tr>
                                <tr>
                                    <td><strong>CDN分发</strong></td>
                                    <td>内容加速分发</td>
                                    <td>边缘缓存、智能调度</td>
                                    <td>命中率 > 95%</td>
                                </tr>
                                <tr>
                                    <td><strong>播放器</strong></td>
                                    <td>解码渲染播放</td>
                                    <td>HLS/DASH/FLV</td>
                                    <td>首屏 < 2秒</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- 流媒体协议 -->
                    <div class="topic-item" id="protocols">
                        <h3>流媒体协议详解</h3>
                        
                        <div class="diagram-container">
                            <div class="diagram-title">主流流媒体协议对比</div>
                            <pre class="mermaid">
graph TB
    A[流媒体协议] --> B[RTMP]
    A --> C[HLS]
    A --> D[DASH]
    A --> E[WebRTC]
    
    B --> B1[基于TCP]
    B --> B2[低延迟直播]
    B --> B3[Flash推流]
    
    C --> C1[基于HTTP]
    C --> C2[Apple标准]
    C --> C3[m3u8+ts切片]
    
    D --> D1[基于HTTP]
    D --> D2[国际标准]
    D --> D3[mpd+m4s切片]
    
    E --> E1[基于UDP]
    E --> E2[P2P传输]
    E --> E3[实时通信]
    
    style A fill:#667eea,color:#fff
    style B fill:#f3e5f5
    style C fill:#c8e6c9
    style D fill:#fff9c4
    style E fill:#bbdefb
                            </pre>
                        </div>

                        <table class="visual-table">
                            <thead>
                                <tr>
                                    <th>协议</th>
                                    <th>传输层</th>
                                    <th>延迟</th>
                                    <th>特点</th>
                                    <th>应用场景</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>RTMP</strong></td>
                                    <td>TCP</td>
                                    <td>2-5秒</td>
                                    <td>低延迟、Flash生态</td>
                                    <td>直播推流</td>
                                </tr>
                                <tr>
                                    <td><strong>HLS</strong></td>
                                    <td>HTTP</td>
                                    <td>5-30秒</td>
                                    <td>兼容性好、防火墙穿透</td>
                                    <td>点播、直播</td>
                                </tr>
                                <tr>
                                    <td><strong>DASH</strong></td>
                                    <td>HTTP</td>
                                    <td>5-30秒</td>
                                    <td>开放标准、灵活</td>
                                    <td>点播服务</td>
                                </tr>
                                <tr>
                                    <td><strong>WebRTC</strong></td>
                                    <td>UDP</td>
                                    <td>< 500ms</td>
                                    <td>超低延迟、P2P</td>
                                    <td>视频会议</td>
                                </tr>
                                <tr>
                                    <td><strong>SRT</strong></td>
                                    <td>UDP</td>
                                    <td>1-3秒</td>
                                    <td>抗丢包、低延迟</td>
                                    <td>专业直播</td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="diagram-container">
                            <div class="diagram-title">HLS协议工作流程</div>
                            <pre class="mermaid">
sequenceDiagram
    participant C as 客户端
    participant S as 服务器
    participant CDN as CDN节点
    
    C->>S: 请求m3u8播放列表
    S->>C: 返回m3u8索引
    Note over C: 解析播放列表
    
    loop 播放循环
        C->>CDN: 请求TS切片
        CDN->>C: 返回TS视频片段
        Note over C: 解码播放
        C->>C: 检测带宽
        C->>S: 请求合适码率m3u8
        S->>C: 返回新m3u8
    end
    
    Note over C,CDN: 自适应码率切换
                            </pre>
                        </div>
                    </div>

                    <!-- 直播技术 -->
                    <div class="topic-item" id="live">
                        <h3>直播技术架构</h3>
                        
                        <div class="diagram-container">
                            <div class="diagram-title">直播系统完整流程</div>
                            <pre class="mermaid">
flowchart LR
    A[主播端] --> B[推流<br/>RTMP]
    B --> C[流媒体服务器]
    C --> D[实时转码]
    D --> E[切片封装]
    E --> F[HLS/DASH流]
    F --> G[CDN分发]
    G --> H[边缘节点]
    H --> I[观众端播放]
    
    C --> J[录制存储]
    J --> K[点播回放]
    
    style A fill:#e3f2fd
    style I fill:#c8e6c9
                            </pre>
                        </div>

                        <div class="comparison-box">
                            <div class="comparison-item">
                                <h4>传统直播</h4>
                                <ul>
                                    <li>RTMP推流</li>
                                    <li>FLV/HLS播放</li>
                                    <li>延迟5-10秒</li>
                                    <li>架构成熟稳定</li>
                                </ul>
                            </div>
                            <div class="comparison-item">
                                <h4>低延迟直播</h4>
                                <ul>
                                    <li>WebRTC/SRT</li>
                                    <li>LL-HLS协议</li>
                                    <li>延迟 < 2秒</li>
                                    <li>互动性强</li>
                                </div>
                            </div>
                        </div>

                        <div class="knowledge-card">
                            <h4>🎬 直播关键技术指标</h4>
                            <ul>
                                <li><strong>首屏时间</strong>：从点击到画面显示，目标 < 2秒</li>
                                <li><strong>端到端延迟</strong>：从采集到播放，传统5-10秒，低延迟 < 2秒</li>
                                <li><strong>抗卡顿</strong>：缓冲区管理、码率自适应</li>
                                <li><strong>高并发</strong>：CDN分发、P2P加速</li>
                            </ul>
                        </div>
                    </div>

                    <!-- 点播技术 -->
                    <div class="topic-item" id="vod">
                        <h3>视频点播技术</h3>
                        
                        <div class="diagram-container">
                            <div class="diagram-title">点播系统处理流程</div>
                            <pre class="mermaid">
flowchart TB
    A[视频上传] --> B[转码处理]
    B --> C[多码率编码]
    C --> D[封装切片]
    D --> E[生成索引]
    E --> F[CDN分发]
    F --> G[用户播放]
    
    B --> B1[H.264/H.265编码]
    C --> C1[多分辨率适配]
    D --> D1[HLS/DASH切片]
    E --> E1[m3u8/mpd清单]
    
    style A fill:#e3f2fd
    style G fill:#c8e6c9
                            </pre>
                        </div>

                        <table class="visual-table">
                            <thead>
                                <tr>
                                    <th>点播功能</th>
                                    <th>技术实现</th>
                                    <th>用户体验提升</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>多码率</strong></td>
                                    <td>自适应码率编码</td>
                                    <td>不同网络环境下流畅播放</td>
                                </tr>
                                <tr>
                                    <td><strong>快进快退</strong></td>
                                    <td>关键帧索引、分片加载</td>
                                    <td>快速定位播放位置</td>
                                </tr>
                                <tr>
                                    <td><strong>断点续播</strong></td>
                                    <td>播放进度存储</td>
                                    <td>跨设备继续观看</td>
                                </tr>
                                <tr>
                                    <td><strong>倍速播放</strong></td>
                                    <td>变速解码</td>
                                    <td>灵活控制观看节奏</td>
                                </tr>
                                <tr>
                                    <td><strong>字幕多音轨</strong></td>
                                    <td>流分离、动态切换</td>
                                    <td>支持多语言、无障碍</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- CDN分发 -->
                    <div class="topic-item" id="cdn">
                        <h3>CDN内容分发网络</h3>
                        
                        <div class="diagram-container">
                            <div class="diagram-title">CDN分发架构</div>
                            <pre class="mermaid">
graph TB
    subgraph Origin["源站"]
        O1[流媒体服务器]
        O2[存储系统]
    end
    
    subgraph CDN["CDN网络"]
        C1[中心节点]
        C2[区域节点]
        C3[边缘节点]
    end
    
    subgraph Users["用户端"]
        U1[北京用户]
        U2[上海用户]
        U3[广州用户]
        U4[海外用户]
    end
    
    O1 --> C1
    C1 --> C2
    C2 --> C3
    
    C3 --> U1
    C3 --> U2
    C3 --> U3
    C3 --> U4
    
    O1 -.-> O2
    
    style Origin fill:#e3f2fd
    style CDN fill:#fff9c4
    style Users fill:#c8e6c9
                            </pre>
                        </div>

                        <div class="comparison-box">
                            <div class="comparison-item">
                                <h4>CDN优势</h4>
                                <ul>
                                    <li>就近访问降低延迟</li>
                                    <li>减轻源站压力</li>
                                    <li>提高带宽利用率</li>
                                    <li>增强抗攻击能力</li>
                                </ul>
                            </div>
                            <div class="comparison-item">
                                <h4>缓存策略</h4>
                                <ul>
                                    <li>热点内容预缓存</li>
                                    <li>TTL过期机制</li>
                                    <li>LRU淘汰算法</li>
                                    <li>动态回源策略</li>
                                </ul>
                            </div>
                        </div>

                        <div class="knowledge-card">
                            <h4>⚡ CDN性能优化</h4>
                            <ul>
                                <li><strong>命中率优化</strong>：预热热门内容、智能缓存</li>
                                <li><strong>调度优化</strong>：基于地理位置、网络质量智能调度</li>
                                <li><strong>传输优化</strong>：HTTP/2、QUIC协议加速</li>
                                <li><strong>安全防护</strong>：防盗链、DDoS防护、HTTPS加密</li>
                            </ul>
                        </div>
                    </div>

                    <!-- 自适应码率 -->
                    <div class="topic-item" id="abr">
                        <h3>自适应码率技术 (ABR)</h3>
                        
                        <div class="diagram-container">
                            <div class="diagram-title">ABR自适应码率切换流程</div>
                            <pre class="mermaid">
sequenceDiagram
    participant P as 播放器
    participant N as 网络监测
    participant A as ABR算法
    participant CDN as CDN服务器
    
    P->>N: 持续监测网络状态
    N->>A: 上报带宽、延迟、丢包
    A->>A: 计算最优码率
    
    alt 网络变差
        A->>P: 切换到低码率
        P->>CDN: 请求低码率切片
        CDN->>P: 返回低码率视频
    else 网络变好
        A->>P: 切换到高码率
        P->>CDN: 请求高码率切片
        CDN->>P: 返回高码率视频
    end
    
    Note over P,CDN: 无缝切换，不中断播放
                            </pre>
                        </div>

                        <table class="visual-table">
                            <thead>
                                <tr>
                                    <th>ABR算法</th>
                                    <th>原理</th>
                                    <th>优点</th>
                                    <th>缺点</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>吞吐量算法</strong></td>
                                    <td>基于带宽预测</td>
                                    <td>实现简单</td>
                                    <td>带宽波动敏感</td>
                                </tr>
                                <tr>
                                    <td><strong>缓冲区算法</strong></td>
                                    <td>基于缓冲区水位</td>
                                    <td>稳定性好</td>
                                    <td>响应较慢</td>
                                </tr>
                                <tr>
                                    <td><strong>混合算法</strong></td>
                                    <td>带宽+缓冲区</td>
                                    <td>平衡性好</td>
                                    <td>参数调优复杂</td>
                                </tr>
                                <tr>
                                    <td><strong>学习型算法</strong></td>
                                    <td>机器学习预测</td>
                                    <td>适应性强</td>
                                    <td>训练成本高</td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="flow-steps">
                            <div class="flow-step">网络监测</div>
                            <div class="flow-step">带宽预测</div>
                            <div class="flow-step">码率选择</div>
                            <div class="flow-step">平滑切换</div>
                        </div>
                        <p style="text-align: center; color: #718096; margin-top: 10px;">ABR工作流程</p>

                        <div class="knowledge-card">
                            <h4>🎯 ABR关键指标</h4>
                            <ul>
                                <li><strong>码率切换次数</strong>：越少越好，避免频繁切换</li>
                                <li><strong>平均码率</strong>：在稳定前提下尽可能高</li>
                                <li><strong>缓冲时长</strong>：避免缓冲不足导致卡顿</li>
                                <li><strong>切换平滑度</strong>：无缝切换，无黑屏跳变</li>
                            </ul>
                        </div>
                    </div>

                </div>
            </section>
        </main>
    </div>

    <script>
        // 平滑滚动
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // 高亮当前导航项
        const observerOptions = {
            root: null,
            rootMargin: '-20% 0px -70% 0px',
            threshold: 0
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const id = entry.target.getAttribute('id');
                    document.querySelectorAll('.sidebar-nav a').forEach(link => {
                        link.classList.remove('active');
                        if (link.getAttribute('href') === `#${id}`) {
                            link.classList.add('active');
                        }
                    });
                }
            });
        }, observerOptions);

        document.querySelectorAll('.topic-item[id]').forEach(item => {
            observer.observe(item);
        });
    </script>
</body>
</html>

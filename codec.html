<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>编解码技术 - 视频处理学习</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'base',
            themeVariables: {
                primaryColor: '#667eea',
                primaryTextColor: '#fff',
                primaryBorderColor: '#764ba2',
                lineColor: '#667eea',
                secondaryColor: '#764ba2',
                tertiaryColor: '#f0f0f0'
            }
        });
    </script>
</head>
<body>
    <div class="layout-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1><a href="index.html" style="color: white; text-decoration: none;">VideoLearn</a></h1>
            </div>
            <nav class="sidebar-nav">
                <ul class="nav-tree">
                    <li>
                        <span class="nav-category">其他章节</span>
                        <ul class="sub-nav">
                            <li><a href="basics.html">基础知识</a></li>
                            <li><a href="ai.html">AI视频处理</a></li>
                            <li><a href="streaming.html">在线视频</a></li>
                            <li><a href="tools.html">工具框架</a></li>
                            <li><a href="code.html">代码示例</a></li>
                        </ul>
                    </li>
                    <li>
                        <span class="nav-category">编解码技术</span>
                        <ul class="sub-nav">
                            <li><a href="#codec-compare" class="active">编码标准对比</a></li>
                            <li><a href="#h264">H.264/AVC</a></li>
                            <li><a href="#h265">H.265/HEVC</a></li>
                            <li><a href="#av1">AV1</a></li>
                            <li><a href="#vp9">VP9</a></li>
                            <li><a href="#encoding-flow">编码流程</a></li>
                        </ul>
                    </li>
                </ul>
            </nav>
        </aside>

        <main class="main-content">
            <section id="codec" class="section">
                <div class="container">
                    <h2>🎬 编解码技术可视化</h2>
                    <p style="color: #718096; margin-bottom: 30px;">通过对比表格和流程图深入理解视频编码标准</p>

                    <!-- 编码标准对比 -->
                    <div class="topic-item" id="codec-compare">
                        <h3>主流编码标准对比</h3>
                        
                        <table class="visual-table">
                            <thead>
                                <tr>
                                    <th>特性</th>
                                    <th>H.264/AVC</th>
                                    <th>H.265/HEVC</th>
                                    <th>AV1</th>
                                    <th>VP9</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>发布年份</strong></td>
                                    <td>2003</td>
                                    <td>2013</td>
                                    <td>2018</td>
                                    <td>2013</td>
                                </tr>
                                <tr>
                                    <td><strong>开发组织</strong></td>
                                    <td>ITU-T/ISO</td>
                                    <td>ITU-T/ISO</td>
                                    <td>AOMedia</td>
                                    <td>Google</td>
                                </tr>
                                <tr>
                                    <td><strong>专利授权</strong></td>
                                    <td>💰 收费</td>
                                    <td>💰 收费</td>
                                    <td>✅ 免费</td>
                                    <td>✅ 免费</td>
                                </tr>
                                <tr>
                                    <td><strong>压缩效率</strong></td>
                                    <td>基准</td>
                                    <td>+50%</td>
                                    <td>+30%</td>
                                    <td>+20%</td>
                                </tr>
                                <tr>
                                    <td><strong>编码复杂度</strong></td>
                                    <td>⭐⭐⭐</td>
                                    <td>⭐⭐⭐⭐⭐</td>
                                    <td>⭐⭐⭐⭐⭐⭐</td>
                                    <td>⭐⭐⭐⭐</td>
                                </tr>
                                <tr>
                                    <td><strong>硬件支持</strong></td>
                                    <td>✅ 广泛</td>
                                    <td>✅ 良好</td>
                                    <td>⚠️ 发展中</td>
                                    <td>✅ 良好</td>
                                </tr>
                                <tr>
                                    <td><strong>应用场景</strong></td>
                                    <td>实时通讯、直播</td>
                                    <td>4K/8K视频</td>
                                    <td>流媒体平台</td>
                                    <td>WebRTC</td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="diagram-container">
                            <div class="diagram-title">编码效率与复杂度关系</div>
                            <pre class="mermaid">
graph LR
    A[H.264/AVC<br/>基准] --> B[VP9<br/>+20%效率]
    B --> C[H.265/HEVC<br/>+50%效率]
    C --> D[AV1<br/>+30%效率]
    
    A --> A1[编码速度: 快]
    B --> B1[编码速度: 中等]
    C --> C1[编码速度: 慢]
    D --> D1[编码速度: 很慢]
    
    style A fill:#c8e6c9
    style B fill:#fff9c4
    style C fill:#bbdefb
    style D fill:#f3e5f5
                            </pre>
                        </div>
                    </div>

                    <!-- H.264 -->
                    <div class="topic-item" id="h264">
                        <h3>H.264/AVC 详解</h3>
                        
                        <div class="diagram-container">
                            <div class="diagram-title">H.264编码架构</div>
                            <pre class="mermaid">
flowchart TB
    subgraph Input["输入处理"]
        A[原始帧] --> B[帧类型判断]
    end
    
    subgraph Prediction["预测编码"]
        B --> C{帧类型}
        C -->|I帧| D[帧内预测]
        C -->|P/B帧| E[帧间预测]
        E --> F[运动估计]
        F --> G[运动补偿]
    end
    
    subgraph Transform["变换量化"]
        D --> H[残差]
        G --> H
        H --> I[DCT变换]
        I --> J[量化]
    end
    
    subgraph Encoding["熵编码"]
        J --> K[CAVLC/CABAC]
        K --> L[输出码流]
    end
    
    subgraph Loop["解码环路"]
        J --> M[反量化]
        M --> N[反变换]
        N --> O[重建帧]
        O --> P[去块滤波]
        P --> Q[参考帧缓存]
        Q --> G
    end
    
    style Input fill:#e3f2fd
    style Prediction fill:#f3e5f5
    style Transform fill:#fff9c4
    style Encoding fill:#c8e6c9
                            </pre>
                        </div>

                        <div class="comparison-box">
                            <div class="comparison-item">
                                <h4>帧内预测</h4>
                                <ul>
                                    <li>4×4块: 9种模式</li>
                                    <li>16×16块: 4种模式</li>
                                    <li>利用空间相关性</li>
                                    <li>I帧的核心技术</li>
                                </ul>
                            </div>
                            <div class="comparison-item">
                                <h4>帧间预测</h4>
                                <ul>
                                    <li>运动估计精度: 1/4像素</li>
                                    <li>多参考帧: 最多16帧</li>
                                    <li>宏块分割: 7种模式</li>
                                    <li>P/B帧的核心</li>
                                </ul>
                            </div>
                            <div class="comparison-item">
                                <h4>熵编码</h4>
                                <ul>
                                    <li>CAVLC: 较简单</li>
                                    <li>CABAC: 压缩率更高</li>
                                    <li>基于上下文</li>
                                    <li>自适应编码</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- H.265 -->
                    <div class="topic-item" id="h265">
                        <h3>H.265/HEVC 详解</h3>
                        
                        <div class="diagram-container">
                            <div class="diagram-title">H.265 vs H.264 技术对比</div>
                            <pre class="mermaid">
graph TB
    subgraph H264["H.264/AVC"]
        A1[宏块: 16×16]
        A2[帧内预测: 9种]
        A3[变换: 4×4/8×8 DCT]
        A4[运动矢量精度: 1/4像素]
    end
    
    subgraph H265["H.265/HEVC"]
        B1[CTU: 64×64]
        B2[帧内预测: 35种]
        B3[变换: 4×4~32×32]
        B4[运动矢量精度: 1/4像素]
    end
    
    A1 --> B1
    A2 --> B2
    A3 --> B3
    A4 --> B4
    
    style H264 fill:#e3f2fd
    style H265 fill:#c8e6c9
                            </pre>
                        </div>

                        <table class="visual-table">
                            <thead>
                                <tr>
                                    <th>技术特性</th>
                                    <th>H.264</th>
                                    <th>H.265</th>
                                    <th>改进</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>编码单元</strong></td>
                                    <td>宏块 16×16</td>
                                    <td>CTU 64×64</td>
                                    <td>更灵活的分割</td>
                                </tr>
                                <tr>
                                    <td><strong>帧内预测</strong></td>
                                    <td>9种模式</td>
                                    <td>35种模式</td>
                                    <td>更精细的方向</td>
                                </tr>
                                <tr>
                                    <td><strong>变换尺寸</strong></td>
                                    <td>4×4, 8×8</td>
                                    <td>4×4 ~ 32×32</td>
                                    <td>更大变换块</td>
                                </tr>
                                <tr>
                                    <td><strong>并行工具</strong></td>
                                    <td>有限</td>
                                    <td>Tile/WPP</td>
                                    <td>更好的并行</td>
                                </tr>
                                <tr>
                                    <td><strong>环路滤波</strong></td>
                                    <td>去块滤波</td>
                                    <td>去块+SAO</td>
                                    <td>减少伪影</td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="diagram-container">
                            <div class="diagram-title">CTU编码树单元结构</div>
                            <pre class="mermaid>
graph TB
    A[CTU 64×64] --> B[Cu分割]
    B --> C[CU 32×32]
    B --> D[CU 32×32]
    B --> E[CU 32×32]
    B --> F[CU 32×32]
    
    C --> C1[PU预测单元]
    C --> C2[TU变换单元]
    
    E --> E1[进一步分割]
    E1 --> E2[CU 16×16]
    E1 --> E3[CU 16×16]
    
    style A fill:#667eea,color:#fff
    style C fill:#c8e6c9
    style D fill:#c8e6c9
    style E fill:#f3e5f5
    style F fill:#c8e6c9
                            </pre>
                        </div>
                    </div>

                    <!-- AV1 -->
                    <div class="topic-item" id="av1">
                        <h3>AV1 编码标准</h3>
                        
                        <div class="diagram-container">
                            <div class="diagram-title">AV1编码特性</div>
                            <pre class="mermaid">
graph TB
    A[AV1 AOMedia Video 1] --> B[开源免费]
    A --> C[先进编码工具]
    A --> D[超高压缩效率]
    
    B --> B1[无专利费用]
    B --> B2[AOMedia联盟]
    B --> B3[Google主导]
    
    C --> C1[更大的SB 128×128]
    C --> C2[更多的帧内模式]
    C --> C3[CDEF约束方向增强]
    C --> C4[LR环路恢复滤波]
    C --> C5[多符号算术编码]
    
    D --> D1[比VP9节省30%]
    D --> D2[与H.265相当]
    D --> D3[编码时间更长]
    
    style A fill:#667eea,color:#fff
    style B fill:#c8e6c9
    style C fill:#fff9c4
    style D fill:#f3e5f5
                            </pre>
                        </div>

                        <div class="knowledge-card">
                            <h4>🎬 AV1 应用现状</h4>
                            <ul>
                                <li><strong>YouTube</strong>：支持AV1编码播放</li>
                                <li><strong>Netflix</strong>：部分内容采用AV1</li>
                                <li><strong>浏览器支持</strong>：Chrome、Firefox、Edge原生支持</li>
                                <li><strong>硬件解码</strong>：新一代GPU逐步支持</li>
                            </ul>
                        </div>
                    </div>

                    <!-- VP9 -->
                    <div class="topic-item" id="vp9">
                        <h3>VP9 编码标准</h3>
                        
                        <div class="diagram-container">
                            <div class="diagram-title">VP9编码流程</div>
                            <pre class="mermaid">
flowchart LR
    A[输入帧] --> B[超级块分割<br/>64×64]
    B --> C[帧内/帧间预测]
    C --> D[变换编码]
    D --> E[量化]
    E --> F[熵编码]
    F --> G[输出码流]
    
    E --> H[反量化]
    H --> I[反变换]
    I --> J[环路滤波]
    J --> K[参考帧存储]
    K --> C
    
    style A fill:#e3f2fd
    style G fill:#c8e6c9
                            </pre>
                        </div>

                        <div class="comparison-box">
                            <div class="comparison-item">
                                <h4>VP9 优势</h4>
                                <ul>
                                    <li>完全免费开源</li>
                                    <li>编码速度快于AV1</li>
                                    <li>硬件支持广泛</li>
                                    <li>WebRTC首选</li>
                                </ul>
                            </div>
                            <div class="comparison-item">
                                <h4>VP9 劣势</h4>
                                <ul>
                                    <li>压缩效率低于AV1</li>
                                    <li>编码工具较少</li>
                                    <li>不支持屏幕内容</li>
                                    <li>生态不如H.264</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- 编码流程 -->
                    <div class="topic-item" id="encoding-flow">
                        <h3>视频编码通用流程</h3>
                        
                        <div class="diagram-container">
                            <div class="diagram-title">混合编码框架完整流程</div>
                            <pre class="mermaid">
flowchart TB
    subgraph Input["输入模块"]
        A1[原始视频] --> A2[预处理]
        A2 --> A3[帧划分]
    end
    
    subgraph Prediction["预测模块"]
        A3 --> B1{预测选择}
        B1 -->|I帧| B2[帧内预测]
        B1 -->|P/B帧| B3[帧间预测]
        B3 --> B4[运动估计]
        B4 --> B5[运动补偿]
    end
    
    subgraph Transform["变换量化模块"]
        B2 --> C1[预测残差]
        B5 --> C1
        C1 --> C2[整数变换 DCT/DST]
        C2 --> C3[量化 QP控制]
    end
    
    subgraph Encoding["熵编码模块"]
        C3 --> D1[量化系数]
        D1 --> D2[CABAC/CAVLC/Range Coding]
        D2 --> D3[输出码流]
    end
    
    subgraph Loop["解码环路"]
        C3 --> E1[反量化]
        E1 --> E2[反变换]
        E2 --> E3[重建残差]
        E3 --> E4[预测值相加]
        E4 --> E5[重建帧]
        E5 --> E6[环路滤波 Deblock/SAO]
        E6 --> E7[参考帧缓存]
        E7 --> B5
    end
    
    style Input fill:#e3f2fd
    style Prediction fill:#f3e5f5
    style Transform fill:#fff9c4
    style Encoding fill:#c8e6c9
    style Loop fill:#bbdefb
                            </pre>
                        </div>

                        <div class="flow-steps">
                            <div class="flow-step">1. 预测</div>
                            <div class="flow-step">2. 变换</div>
                            <div class="flow-step">3. 量化</div>
                            <div class="flow-step">4. 熵编码</div>
                        </div>
                        <p style="text-align: center; color: #718096; margin-top: 10px;">编码核心四步骤</p>

                        <div class="knowledge-card">
                            <h4>🔑 编码器选择指南</h4>
                            <table class="visual-table" style="margin-top: 10px;">
                                <thead>
                                    <tr>
                                        <th>应用场景</th>
                                        <th>推荐编码</th>
                                        <th>原因</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>实时通讯</td>
                                        <td>H.264</td>
                                        <td>硬件支持好、延迟低</td>
                                    </tr>
                                    <tr>
                                        <td>4K/8K视频</td>
                                        <td>H.265</td>
                                        <td>压缩效率高、硬件支持</td>
                                    </tr>
                                    <tr>
                                        <td>Web视频</td>
                                        <td>AV1/VP9</td>
                                        <td>免费、浏览器支持</td>
                                    </tr>
                                    <tr>
                                        <td>视频会议</td>
                                        <td>VP9</td>
                                        <td>WebRTC优化、免费</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>
            </section>
        </main>
    </div>

    <script>
        // 平滑滚动
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // 高亮当前导航项
        const observerOptions = {
            root: null,
            rootMargin: '-20% 0px -70% 0px',
            threshold: 0
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const id = entry.target.getAttribute('id');
                    document.querySelectorAll('.sidebar-nav a').forEach(link => {
                        link.classList.remove('active');
                        if (link.getAttribute('href') === `#${id}`) {
                            link.classList.add('active');
                        }
                    });
                }
            });
        }, observerOptions);

        document.querySelectorAll('.topic-item[id]').forEach(item => {
            observer.observe(item);
        });
    </script>
</body>
</html>
